version: "1.0.0"
title: "Firmware OTA Pipeline"
description: "Compile, sign, and distribute IoT firmware."
instructions: |
  Manage the lifecycle of IoT firmware updates.
  1. Develop and compile the firmware code using Agent 59.
  2. Implement update logic and brick prevention using Agent 59 (acting as OTA specialist).
  3. Ensure the update process is secure using Agent 07.
    
parameters:
  - key: firmware_version
    input_type: string
    requirement: required
    description: "The target version number for the release."
  - key: target_platform
    input_type: string
    requirement: required
    description: "Hardware platform identifier (e.g., esp32, stm32)."

sub_recipes:
  - name: "agent_59_the_driver"
    path: "./agents/59-the-driver.yaml"
  - name: "agent_07_the_double_o"
    path: "./agents/07-the-double-o.yaml"
  # TODO: Switch to Agent 149 (The OTA) for specialised update logic.
  # TODO: Switch to Agent 93 (The Embedded) for microcontroller specifics.

extensions:
  - type: builtin
    name: developer
    timeout: 300
    bundled: true

prompt: |
  Prepare version {{ firmware_version }} for the {{ target_platform }} device.
    
  1. 'agent_59_the_driver': Compile the latest firmware build and prepare the binary.
  2. 'agent_07_the_double_o': Sign the binary and verify the integrity of the update package.
  3. 'agent_59_the_driver': Generate the partition table and rollback scripts (simulating OTA logic).
