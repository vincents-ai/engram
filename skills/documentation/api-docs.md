---
name: engram-api-docs
description: "Generate comprehensive API documentation with OpenAPI/Swagger specifications, request/response examples, error cases, and edge cases. Keep docs in sync with code."
---

# API Documentation (Engram-Integrated)

## Overview

Generate and maintain comprehensive API documentation by creating OpenAPI/Swagger specifications, documenting request/response formats, providing realistic examples, covering error cases and edge cases. Store documentation decisions and updates in Engram to track evolution and ensure docs stay synchronized with code.

## When to Use

Use this skill when:
- Designing a new API that will be consumed by others
- Adding new endpoints to an existing API
- Onboarding developers who will integrate with your API
- Publishing API for external partners or public use
- Updating API and need to communicate breaking changes
- Investigating why API consumers are having integration issues
- Generating client SDKs from API specification
- Setting up API testing based on specification

## The Pattern

### Step 1: Create OpenAPI Specification

Start with OpenAPI 3.0 specification for your API:

```bash
engram context create \
  --title "API Specification: [API Name]" \
  --content "## OpenAPI Specification\n\n\`\`\`yaml\nopenapi: 3.0.3\ninfo:\n  title: [API Name]\n  description: |\n    [API description and purpose]\n    \n    ## Authentication\n    All endpoints require Bearer token authentication except where noted.\n    \n    ## Rate Limiting\n    - Free tier: 1000 requests per hour\n    - Paid tier: 10,000 requests per hour\n    \n    ## Base URL\n    Production: https://api.example.com/v1\n    Staging: https://api-staging.example.com/v1\n  version: 1.0.0\n  contact:\n    name: API Support\n    email: api-support@example.com\n    url: https://example.com/support\n  license:\n    name: Apache 2.0\n    url: https://www.apache.org/licenses/LICENSE-2.0.html\n\nservers:\n  - url: https://api.example.com/v1\n    description: Production\n  - url: https://api-staging.example.com/v1\n    description: Staging\n\ncomponents:\n  securitySchemes:\n    BearerAuth:\n      type: http\n      scheme: bearer\n      bearerFormat: JWT\n      description: JWT token obtained from /auth/login endpoint\n\n  schemas:\n    User:\n      type: object\n      properties:\n        id:\n          type: string\n          format: uuid\n          description: Unique user identifier\n          example: 550e8400-e29b-41d4-a716-446655440000\n        email:\n          type: string\n          format: email\n          description: User email address\n          example: user@example.com\n        name:\n          type: string\n          description: User full name\n          example: Alice Smith\n        created_at:\n          type: string\n          format: date-time\n          description: User creation timestamp (ISO 8601 UTC)\n          example: 2026-01-24T12:00:00Z\n        updated_at:\n          type: string\n          format: date-time\n          description: Last update timestamp (ISO 8601 UTC)\n          example: 2026-01-24T13:30:00Z\n      required:\n        - id\n        - email\n        - created_at\n    \n    Document:\n      type: object\n      properties:\n        id:\n          type: string\n          format: uuid\n          example: 660f9511-f3ab-52e5-b827-557766551111\n        title:\n          type: string\n          minLength: 1\n          maxLength: 200\n          example: Project Proposal\n        content:\n          type: string\n          maxLength: 50000\n          example: This document outlines...\n        owner_id:\n          type: string\n          format: uuid\n          description: User ID of document owner\n          example: 550e8400-e29b-41d4-a716-446655440000\n        visibility:\n          type: string\n          enum:\n            - private\n            - public\n            - shared\n          default: private\n          example: private\n        created_at:\n          type: string\n          format: date-time\n          example: 2026-01-24T12:00:00Z\n        updated_at:\n          type: string\n          format: date-time\n          example: 2026-01-24T14:15:00Z\n      required:\n        - id\n        - title\n        - owner_id\n        - visibility\n        - created_at\n        - updated_at\n    \n    Error:\n      type: object\n      properties:\n        error:\n          type: object\n          properties:\n            code:\n              type: string\n              description: Machine-readable error code\n              example: VALIDATION_ERROR\n            message:\n              type: string\n              description: Human-readable error message\n              example: Request validation failed\n            details:\n              type: array\n              description: Detailed field-level errors\n              items:\n                type: object\n                properties:\n                  field:\n                    type: string\n                    example: email\n                  code:\n                    type: string\n                    example: INVALID_FORMAT\n                  message:\n                    type: string\n                    example: Must be valid email format\n            request_id:\n              type: string\n              description: Request ID for tracing and support\n              example: req_abc123xyz\n          required:\n            - code\n            - message\n            - request_id\n    \n    PaginatedDocuments:\n      type: object\n      properties:\n        data:\n          type: array\n          items:\n            \$ref: '#/components/schemas/Document'\n        pagination:\n          type: object\n          properties:\n            page:\n              type: integer\n              minimum: 1\n              example: 1\n            limit:\n              type: integer\n              minimum: 1\n              maximum: 100\n              example: 20\n            total:\n              type: integer\n              description: Total number of items\n              example: 150\n            total_pages:\n              type: integer\n              description: Total number of pages\n              example: 8\n        links:\n          type: object\n          properties:\n            first:\n              type: string\n              example: /api/v1/documents?page=1&limit=20\n            prev:\n              type: string\n              nullable: true\n              example: null\n            next:\n              type: string\n              nullable: true\n              example: /api/v1/documents?page=2&limit=20\n            last:\n              type: string\n              example: /api/v1/documents?page=8&limit=20\n\npaths:\n  /users/{id}:\n    get:\n      summary: Get user by ID\n      description: |\n        Retrieve a user by their unique identifier.\n        \n        ## Permissions\n        - User can retrieve their own profile\n        - Admins can retrieve any user profile\n      operationId: getUserById\n      tags:\n        - Users\n      security:\n        - BearerAuth: []\n      parameters:\n        - name: id\n          in: path\n          required: true\n          description: User ID\n          schema:\n            type: string\n            format: uuid\n          example: 550e8400-e29b-41d4-a716-446655440000\n      responses:\n        '200':\n          description: User found\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/User'\n              examples:\n                success:\n                  summary: Successful response\n                  value:\n                    id: 550e8400-e29b-41d4-a716-446655440000\n                    email: alice@example.com\n                    name: Alice Smith\n                    created_at: '2026-01-15T10:00:00Z'\n                    updated_at: '2026-01-24T12:00:00Z'\n        '401':\n          description: Unauthorized - Missing or invalid token\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/Error'\n              examples:\n                missing_token:\n                  summary: Missing authentication\n                  value:\n                    error:\n                      code: AUTHENTICATION_REQUIRED\n                      message: Authentication required. Please provide a valid access token.\n                      request_id: req_abc123\n                invalid_token:\n                  summary: Invalid or expired token\n                  value:\n                    error:\n                      code: INVALID_TOKEN\n                      message: Access token is invalid or expired\n                      details:\n                        - reason: TOKEN_EXPIRED\n                          expired_at: '2026-01-24T11:00:00Z'\n                      request_id: req_def456\n        '403':\n          description: Forbidden - Insufficient permissions\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/Error'\n              example:\n                error:\n                  code: PERMISSION_DENIED\n                  message: You do not have permission to access this user\n                  request_id: req_ghi789\n        '404':\n          description: User not found\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/Error'\n              example:\n                error:\n                  code: RESOURCE_NOT_FOUND\n                  message: The requested user was not found\n                  details:\n                    - resource_type: user\n                      resource_id: 550e8400-e29b-41d4-a716-446655440000\n                  request_id: req_jkl012\n        '429':\n          description: Rate limit exceeded\n          headers:\n            X-RateLimit-Limit:\n              schema:\n                type: integer\n              description: Maximum requests allowed per hour\n            X-RateLimit-Remaining:\n              schema:\n                type: integer\n              description: Remaining requests in current window\n            X-RateLimit-Reset:\n              schema:\n                type: integer\n              description: Unix timestamp when rate limit resets\n            Retry-After:\n              schema:\n                type: integer\n              description: Seconds to wait before retrying\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/Error'\n              example:\n                error:\n                  code: RATE_LIMIT_EXCEEDED\n                  message: Rate limit exceeded. Try again in 60 seconds.\n                  retry_after: 60\n                  request_id: req_mno345\n        '500':\n          description: Internal server error\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/Error'\n              example:\n                error:\n                  code: INTERNAL_ERROR\n                  message: An unexpected error occurred. Please try again later.\n                  request_id: req_pqr678\n\n  /documents:\n    get:\n      summary: List documents\n      description: |\n        Retrieve a paginated list of documents.\n        \n        ## Permissions\n        - User sees documents they own\n        - User sees documents shared with them\n        - User sees public documents\n        - Admins see all documents\n      operationId: listDocuments\n      tags:\n        - Documents\n      security:\n        - BearerAuth: []\n      parameters:\n        - name: page\n          in: query\n          description: Page number (1-indexed)\n          schema:\n            type: integer\n            minimum: 1\n            default: 1\n          example: 1\n        - name: limit\n          in: query\n          description: Number of items per page\n          schema:\n            type: integer\n            minimum: 1\n            maximum: 100\n            default: 20\n          example: 20\n        - name: sort\n          in: query\n          description: Sort field and order (field:asc or field:desc)\n          schema:\n            type: string\n            enum:\n              - created_at:asc\n              - created_at:desc\n              - updated_at:asc\n              - updated_at:desc\n              - title:asc\n              - title:desc\n            default: created_at:desc\n          example: created_at:desc\n        - name: visibility\n          in: query\n          description: Filter by visibility\n          schema:\n            type: string\n            enum:\n              - private\n              - public\n              - shared\n          example: public\n        - name: owner_id\n          in: query\n          description: Filter by owner user ID\n          schema:\n            type: string\n            format: uuid\n          example: 550e8400-e29b-41d4-a716-446655440000\n        - name: q\n          in: query\n          description: Full-text search query\n          schema:\n            type: string\n          example: project proposal\n      responses:\n        '200':\n          description: Documents retrieved successfully\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/PaginatedDocuments'\n              examples:\n                with_results:\n                  summary: Documents found\n                  value:\n                    data:\n                      - id: 660f9511-f3ab-52e5-b827-557766551111\n                        title: Project Proposal\n                        content: This document outlines...\n                        owner_id: 550e8400-e29b-41d4-a716-446655440000\n                        visibility: private\n                        created_at: '2026-01-24T12:00:00Z'\n                        updated_at: '2026-01-24T14:15:00Z'\n                      - id: 770f9511-f3ab-52e5-b827-557766552222\n                        title: Meeting Notes\n                        content: Discussed...\n                        owner_id: 550e8400-e29b-41d4-a716-446655440000\n                        visibility: shared\n                        created_at: '2026-01-23T10:00:00Z'\n                        updated_at: '2026-01-23T10:30:00Z'\n                    pagination:\n                      page: 1\n                      limit: 20\n                      total: 2\n                      total_pages: 1\n                    links:\n                      first: /api/v1/documents?page=1&limit=20\n                      prev: null\n                      next: null\n                      last: /api/v1/documents?page=1&limit=20\n                empty_results:\n                  summary: No documents found\n                  value:\n                    data: []\n                    pagination:\n                      page: 1\n                      limit: 20\n                      total: 0\n                      total_pages: 0\n                    links:\n                      first: /api/v1/documents?page=1&limit=20\n                      prev: null\n                      next: null\n                      last: /api/v1/documents?page=1&limit=20\n        '400':\n          description: Bad request - Invalid query parameters\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/Error'\n              example:\n                error:\n                  code: VALIDATION_ERROR\n                  message: Invalid query parameters\n                  details:\n                    - field: page\n                      code: OUT_OF_RANGE\n                      message: Page must be greater than 0\n                    - field: limit\n                      code: OUT_OF_RANGE\n                      message: Limit must be between 1 and 100\n                  request_id: req_stu901\n        '401':\n          \$ref: '#/paths/~1users~1{id}/get/responses/401'\n        '429':\n          \$ref: '#/paths/~1users~1{id}/get/responses/429'\n        '500':\n          \$ref: '#/paths/~1users~1{id}/get/responses/500'\n    \n    post:\n      summary: Create document\n      description: |\n        Create a new document.\n        \n        ## Permissions\n        - Any authenticated user can create documents\n        - User becomes owner of created document\n      operationId: createDocument\n      tags:\n        - Documents\n      security:\n        - BearerAuth: []\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              properties:\n                title:\n                  type: string\n                  minLength: 1\n                  maxLength: 200\n                  example: My New Document\n                content:\n                  type: string\n                  maxLength: 50000\n                  example: This is the document content...\n                visibility:\n                  type: string\n                  enum:\n                    - private\n                    - public\n                    - shared\n                  default: private\n                  example: private\n              required:\n                - title\n            examples:\n              minimal:\n                summary: Minimal document (title only)\n                value:\n                  title: My Document\n              complete:\n                summary: Complete document\n                value:\n                  title: Project Proposal\n                  content: This document outlines our Q2 strategy...\n                  visibility: shared\n      responses:\n        '201':\n          description: Document created successfully\n          headers:\n            Location:\n              schema:\n                type: string\n              description: URL of created document\n              example: /api/v1/documents/660f9511-f3ab-52e5-b827-557766551111\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/Document'\n              example:\n                id: 660f9511-f3ab-52e5-b827-557766551111\n                title: My New Document\n                content: This is the document content...\n                owner_id: 550e8400-e29b-41d4-a716-446655440000\n                visibility: private\n                created_at: '2026-01-24T15:00:00Z'\n                updated_at: '2026-01-24T15:00:00Z'\n        '400':\n          description: Bad request - Validation failed\n          content:\n            application/json:\n              schema:\n                \$ref: '#/components/schemas/Error'\n              examples:\n                missing_title:\n                  summary: Missing required field\n                  value:\n                    error:\n                      code: VALIDATION_ERROR\n                      message: Request validation failed\n                      details:\n                        - field: title\n                          code: REQUIRED\n                          message: Title is required\n                      request_id: req_vwx234\n                title_too_long:\n                  summary: Field exceeds maximum length\n                  value:\n                    error:\n                      code: VALIDATION_ERROR\n                      message: Request validation failed\n                      details:\n                        - field: title\n                          code: TOO_LONG\n                          message: Title must be at most 200 characters\n                          max: 200\n                          actual: 250\n                      request_id: req_yza567\n        '401':\n          \$ref: '#/paths/~1users~1{id}/get/responses/401'\n        '429':\n          \$ref: '#/paths/~1users~1{id}/get/responses/429'\n        '500':\n          \$ref: '#/paths/~1users~1{id}/get/responses/500'\n\`\`\`" \
  --source "api-docs" \
  --tags "api-docs,openapi,[api-name]"
```

### Step 2: Document Common Patterns

Create reusable documentation for patterns used across API:

```bash
engram reasoning create \
  --title "API Docs: [API Name] - Common Patterns" \
  --task-id [TASK_ID] \
  --content "## Authentication\n\n**Method:** Bearer Token (JWT)\n\n**How to Authenticate:**\n\n1. Obtain token via POST /auth/login:\n   \`\`\`bash\n   curl -X POST https://api.example.com/v1/auth/login \\\n     -H 'Content-Type: application/json' \\\n     -d '{\"email\": \"user@example.com\", \"password\": \"secret\"}'\n   \`\`\`\n\n2. Response includes access token:\n   \`\`\`json\n   {\n     \"access_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\",\n     \"token_type\": \"Bearer\",\n     \"expires_in\": 900\n   }\n   \`\`\`\n\n3. Include token in Authorization header:\n   \`\`\`bash\n   curl -X GET https://api.example.com/v1/users/me \\\n     -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...'\n   \`\`\`\n\n**Token Expiry:**\n- Access tokens expire after 15 minutes\n- Use refresh token to get new access token (POST /auth/refresh)\n- Refresh tokens expire after 7 days\n\n## Pagination\n\n**Query Parameters:**\n- page: Page number (1-indexed, default: 1)\n- limit: Items per page (default: 20, max: 100)\n\n**Example:**\n\`\`\`bash\ncurl 'https://api.example.com/v1/documents?page=2&limit=50'\n\`\`\`\n\n**Response Format:**\n\`\`\`json\n{\n  \"data\": [...],\n  \"pagination\": {\n    \"page\": 2,\n    \"limit\": 50,\n    \"total\": 150,\n    \"total_pages\": 3\n  },\n  \"links\": {\n    \"first\": \"/api/v1/documents?page=1&limit=50\",\n    \"prev\": \"/api/v1/documents?page=1&limit=50\",\n    \"next\": \"/api/v1/documents?page=3&limit=50\",\n    \"last\": \"/api/v1/documents?page=3&limit=50\"\n  }\n}\n\`\`\`\n\n**Cursor-Based Pagination:**\n\nFor real-time feeds, use cursor-based pagination:\n\n\`\`\`bash\ncurl 'https://api.example.com/v1/feed?cursor=eyJpZCI6IjEyMyJ9&limit=20'\n\`\`\`\n\n\`\`\`json\n{\n  \"data\": [...],\n  \"pagination\": {\n    \"next_cursor\": \"eyJpZCI6IjE0MyJ9\",\n    \"has_more\": true\n  }\n}\n\`\`\`\n\n## Filtering\n\n**Simple Filters:**\n\n\`\`\`bash\n# Filter by exact match\ncurl 'https://api.example.com/v1/documents?visibility=public'\n\n# Multiple filters (AND)\ncurl 'https://api.example.com/v1/documents?visibility=public&owner_id=550e8400-...'\n\`\`\`\n\n**Comparison Operators:**\n\n\`\`\`bash\n# Greater than\ncurl 'https://api.example.com/v1/documents?created_after=2026-01-01'\n\n# Less than\ncurl 'https://api.example.com/v1/documents?created_before=2026-12-31'\n\n# Range\ncurl 'https://api.example.com/v1/documents?created_after=2026-01-01&created_before=2026-12-31'\n\`\`\`\n\n## Sorting\n\n**Format:** sort=field:order\n\n\`\`\`bash\n# Sort by created_at descending (newest first)\ncurl 'https://api.example.com/v1/documents?sort=created_at:desc'\n\n# Sort by title ascending\ncurl 'https://api.example.com/v1/documents?sort=title:asc'\n\n# Multi-field sort (comma-separated)\ncurl 'https://api.example.com/v1/documents?sort=priority:desc,created_at:desc'\n\`\`\`\n\n## Search\n\n**Full-Text Search:**\n\n\`\`\`bash\ncurl 'https://api.example.com/v1/documents?q=project+proposal'\n\`\`\`\n\nSearches title and content fields. Returns results ranked by relevance.\n\n## Field Selection\n\n**Sparse Fieldsets:**\n\nReduce response size by requesting only needed fields:\n\n\`\`\`bash\ncurl 'https://api.example.com/v1/users/123?fields=id,email,name'\n\`\`\`\n\n\`\`\`json\n{\n  \"id\": \"550e8400-...\",\n  \"email\": \"user@example.com\",\n  \"name\": \"Alice Smith\"\n}\n\`\`\`\n\n## Rate Limiting\n\n**Limits:**\n- Free tier: 1000 requests per hour\n- Paid tier: 10,000 requests per hour\n- Burst: 50 requests per minute\n\n**Headers:**\n\nEvery response includes rate limit info:\n\n\`\`\`\nX-RateLimit-Limit: 1000\nX-RateLimit-Remaining: 950\nX-RateLimit-Reset: 1706097600\n\`\`\`\n\n**When Limit Exceeded:**\n\n\`\`\`\nHTTP/1.1 429 Too Many Requests\nRetry-After: 60\n\n{\n  \"error\": {\n    \"code\": \"RATE_LIMIT_EXCEEDED\",\n    \"message\": \"Rate limit exceeded. Try again in 60 seconds.\",\n    \"retry_after\": 60\n  }\n}\n\`\`\`\n\n**Best Practices:**\n- Implement exponential backoff\n- Cache responses when possible\n- Use webhooks instead of polling\n\n## Error Handling\n\n**Error Response Format:**\n\nAll errors follow consistent structure:\n\n\`\`\`json\n{\n  \"error\": {\n    \"code\": \"ERROR_CODE\",\n    \"message\": \"Human-readable message\",\n    \"details\": [],\n    \"request_id\": \"req_abc123\"\n  }\n}\n\`\`\`\n\n**Common Error Codes:**\n\n| Code | HTTP Status | Description | Retryable |\n|------|-------------|-------------|----------|\n| VALIDATION_ERROR | 400 | Invalid request format or parameters | No |\n| AUTHENTICATION_REQUIRED | 401 | Missing or invalid auth token | No |\n| PERMISSION_DENIED | 403 | Insufficient permissions | No |\n| RESOURCE_NOT_FOUND | 404 | Resource doesn't exist | No |\n| RATE_LIMIT_EXCEEDED | 429 | Too many requests | Yes (after Retry-After) |\n| INTERNAL_ERROR | 500 | Unexpected server error | Yes (with backoff) |\n| SERVICE_UNAVAILABLE | 503 | Temporary outage | Yes (after Retry-After) |\n\n**Retry Logic Example:**\n\n\`\`\`python\nimport requests\nimport time\n\ndef api_call_with_retry(url, max_retries=3):\n    for attempt in range(max_retries):\n        try:\n            response = requests.get(url)\n            \n            if response.status_code == 200:\n                return response.json()\n            elif response.status_code == 429:\n                retry_after = int(response.headers.get('Retry-After', 60))\n                time.sleep(retry_after)\n            elif response.status_code >= 500:\n                time.sleep(2 ** attempt)  # Exponential backoff\n            else:\n                # Don't retry 4xx errors\n                raise Exception(f\"API error: {response.status_code}\")\n        except requests.exceptions.RequestException:\n            time.sleep(2 ** attempt)\n    \n    raise Exception(\"Max retries exceeded\")\n\`\`\`\n\n## Idempotency\n\n**Idempotent Requests:**\n\nFor POST/PATCH requests that should be idempotent, include Idempotency-Key header:\n\n\`\`\`bash\ncurl -X POST https://api.example.com/v1/documents \\\n  -H 'Authorization: Bearer ...' \\\n  -H 'Idempotency-Key: 550e8400-e29b-41d4-a716-446655440000' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"title\": \"My Document\"}'\n\`\`\`\n\nIf request is retried with same key within 24 hours, returns original response (doesn't create duplicate).\n\n## Versioning\n\n**Current Version:** v1\n\n**URL Format:** /api/v{major}/resource\n\n**Breaking Changes:**\n\nWhen v2 is released:\n- v1 will be supported for 12 months\n- Deprecated endpoints return Deprecation header\n- Migration guide will be provided\n\n**Confidence:** [0.0-1.0]" \
  --confidence [0.0-1.0] \
  --tags "api-docs,patterns,[api-name]"
```

### Step 3: Create Example Workflows

Document common use cases end-to-end:

```bash
engram reasoning create \
  --title "API Docs: [API Name] - Example Workflows" \
  --task-id [TASK_ID] \
  --content "## Workflow 1: Create Account and First Document\n\n**Goal:** Register user, login, create document\n\n### Step 1: Register User\n\n\`\`\`bash\ncurl -X POST https://api.example.com/v1/auth/register \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"email\": \"alice@example.com\",\n    \"password\": \"SecurePass123!\",\n    \"name\": \"Alice Smith\"\n  }'\n\`\`\`\n\n**Response:**\n\n\`\`\`json\n{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"email\": \"alice@example.com\",\n  \"name\": \"Alice Smith\",\n  \"created_at\": \"2026-01-24T12:00:00Z\"\n}\n\`\`\`\n\n### Step 2: Login\n\n\`\`\`bash\ncurl -X POST https://api.example.com/v1/auth/login \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"email\": \"alice@example.com\",\n    \"password\": \"SecurePass123!\"\n  }'\n\`\`\`\n\n**Response:**\n\n\`\`\`json\n{\n  \"access_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NTBlODQwMCIsImVtYWlsIjoiYWxpY2VAZXhhbXBsZS5jb20iLCJpYXQiOjE3MDYwOTc2MDAsImV4cCI6MTcwNjA5ODUwMH0...\",\n  \"token_type\": \"Bearer\",\n  \"expires_in\": 900,\n  \"refresh_token\": \"rt_abc123xyz\"\n}\n\`\`\`\n\n**Save token for subsequent requests.**\n\n### Step 3: Create Document\n\n\`\`\`bash\nexport TOKEN=\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\"\n\ncurl -X POST https://api.example.com/v1/documents \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"title\": \"My First Document\",\n    \"content\": \"Hello, World!\",\n    \"visibility\": \"private\"\n  }'\n\`\`\`\n\n**Response:**\n\n\`\`\`json\n{\n  \"id\": \"660f9511-f3ab-52e5-b827-557766551111\",\n  \"title\": \"My First Document\",\n  \"content\": \"Hello, World!\",\n  \"owner_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"visibility\": \"private\",\n  \"created_at\": \"2026-01-24T12:05:00Z\",\n  \"updated_at\": \"2026-01-24T12:05:00Z\"\n}\n\`\`\`\n\n## Workflow 2: Search and Filter Documents\n\n**Goal:** Find specific documents using search and filters\n\n### Step 1: Search by Keyword\n\n\`\`\`bash\ncurl -X GET \"https://api.example.com/v1/documents?q=project\" \\\n  -H \"Authorization: Bearer $TOKEN\"\n\`\`\`\n\n### Step 2: Filter by Visibility\n\n\`\`\`bash\ncurl -X GET \"https://api.example.com/v1/documents?visibility=public\" \\\n  -H \"Authorization: Bearer $TOKEN\"\n\`\`\`\n\n### Step 3: Combined Search and Filter\n\n\`\`\`bash\ncurl -X GET \"https://api.example.com/v1/documents?q=project&visibility=shared&sort=updated_at:desc&limit=10\" \\\n  -H \"Authorization: Bearer $TOKEN\"\n\`\`\`\n\n**Response:**\n\n\`\`\`json\n{\n  \"data\": [\n    {\n      \"id\": \"770f9511-f3ab-52e5-b827-557766552222\",\n      \"title\": \"Project Proposal Q2\",\n      \"owner_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"visibility\": \"shared\",\n      \"created_at\": \"2026-01-23T10:00:00Z\",\n      \"updated_at\": \"2026-01-24T09:00:00Z\"\n    }\n  ],\n  \"pagination\": {\n    \"page\": 1,\n    \"limit\": 10,\n    \"total\": 1,\n    \"total_pages\": 1\n  },\n  \"links\": {\n    \"first\": \"/api/v1/documents?q=project&visibility=shared&sort=updated_at:desc&limit=10&page=1\",\n    \"prev\": null,\n    \"next\": null,\n    \"last\": \"/api/v1/documents?q=project&visibility=shared&sort=updated_at:desc&limit=10&page=1\"\n  }\n}\n\`\`\`\n\n## Workflow 3: Share Document with Another User\n\n**Goal:** Share document and grant read/write permission\n\n### Step 1: Find User to Share With\n\n\`\`\`bash\ncurl -X GET \"https://api.example.com/v1/users?q=bob\" \\\n  -H \"Authorization: Bearer $TOKEN\"\n\`\`\`\n\n**Response:**\n\n\`\`\`json\n{\n  \"data\": [\n    {\n      \"id\": \"661e9511-f3ab-52e5-b827-557766553333\",\n      \"email\": \"bob@example.com\",\n      \"name\": \"Bob Jones\"\n    }\n  ]\n}\n\`\`\`\n\n### Step 2: Share Document\n\n\`\`\`bash\ncurl -X POST https://api.example.com/v1/documents/660f9511-f3ab-52e5-b827-557766551111/shares \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"user_id\": \"661e9511-f3ab-52e5-b827-557766553333\",\n    \"permission\": \"write\"\n  }'\n\`\`\`\n\n**Response:**\n\n\`\`\`json\n{\n  \"id\": \"881f9511-f3ab-52e5-b827-557766554444\",\n  \"document_id\": \"660f9511-f3ab-52e5-b827-557766551111\",\n  \"user_id\": \"661e9511-f3ab-52e5-b827-557766553333\",\n  \"permission\": \"write\",\n  \"created_at\": \"2026-01-24T12:10:00Z\"\n}\n\`\`\`\n\n### Step 3: Bob Edits Document\n\nBob logs in and edits document:\n\n\`\`\`bash\nexport BOB_TOKEN=\"...\"\n\ncurl -X PATCH https://api.example.com/v1/documents/660f9511-f3ab-52e5-b827-557766551111 \\\n  -H \"Authorization: Bearer $BOB_TOKEN\" \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"content\": \"Updated content by Bob\"\n  }'\n\`\`\`\n\n## Workflow 4: Handle Token Expiry\n\n**Goal:** Refresh access token when expired\n\n### Step 1: Request with Expired Token\n\n\`\`\`bash\ncurl -X GET https://api.example.com/v1/documents \\\n  -H \"Authorization: Bearer $EXPIRED_TOKEN\"\n\`\`\`\n\n**Response:**\n\n\`\`\`json\n{\n  \"error\": {\n    \"code\": \"INVALID_TOKEN\",\n    \"message\": \"Access token is invalid or expired\",\n    \"details\": [\n      {\n        \"reason\": \"TOKEN_EXPIRED\",\n        \"expired_at\": \"2026-01-24T11:00:00Z\"\n      }\n    ],\n    \"request_id\": \"req_abc123\"\n  }\n}\n\`\`\`\n\n### Step 2: Refresh Token\n\n\`\`\`bash\ncurl -X POST https://api.example.com/v1/auth/refresh \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"refresh_token\": \"rt_abc123xyz\"\n  }'\n\`\`\`\n\n**Response:**\n\n\`\`\`json\n{\n  \"access_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"token_type\": \"Bearer\",\n  \"expires_in\": 900,\n  \"refresh_token\": \"rt_def456uvw\"\n}\n\`\`\`\n\n**Note:** Refresh token is rotated (old one is invalidated).\n\n### Step 3: Retry Request with New Token\n\n\`\`\`bash\nexport TOKEN=\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\"\n\ncurl -X GET https://api.example.com/v1/documents \\\n  -H \"Authorization: Bearer $TOKEN\"\n\`\`\`\n\n**Confidence:** [0.0-1.0]" \
  --confidence [0.0-1.0] \
  --tags "api-docs,examples,workflows,[api-name]"
```

### Step 4: Generate API Documentation Site

From OpenAPI spec, generate documentation:

```bash
# Using Redoc
npx @redocly/cli build-docs openapi.yaml -o api-docs.html

# Or using Swagger UI
docker run -p 8080:8080 -v $(pwd)/openapi.yaml:/openapi.yaml swaggerapi/swagger-ui

# Or using Stoplight
# Upload openapi.yaml to Stoplight Studio
```

Store generated docs as context:

```bash
engram context create \
  --title "API Documentation Site: [API Name]" \
  --content "## Generated Documentation\n\n**URL:** https://docs.example.com/api\n\n**Generated From:** openapi.yaml (version 1.0.0)\n\n**Tool:** Redoc\n\n**Last Updated:** 2026-01-24\n\n**Includes:**\n- Interactive API explorer\n- Request/response examples\n- Error code reference\n- Authentication guide\n- Rate limiting info\n- SDKs for Python, JavaScript, Ruby\n\n**Auto-Generated SDKs:**\n\`\`\`bash\n# Python\npip install example-api-client\n\n# JavaScript\nnpm install @example/api-client\n\n# Ruby\ngem install example-api-client\n\`\`\`\n\n**Example Usage (Python SDK):**\n\`\`\`python\nfrom example_api_client import ExampleAPI\n\nclient = ExampleAPI(api_key=\"your-api-key\")\n\n# Create document\ndoc = client.documents.create(\n    title=\"My Document\",\n    content=\"Hello, World!\",\n    visibility=\"private\"\n)\n\nprint(f\"Created document: {doc.id}\")\n\n# List documents\ndocs = client.documents.list(page=1, limit=20)\nfor doc in docs:\n    print(f\"- {doc.title}\")\n\`\`\`" \
  --source "api-docs" \
  --tags "api-docs,generated,[api-name]"
```

### Step 5: Keep Docs in Sync with Code

Document sync strategy:

```bash
engram reasoning create \
  --title "API Docs: [API Name] - Sync Strategy" \
  --task-id [TASK_ID] \
  --content "## Documentation Sync Strategy\n\n**Problem:** API code and documentation drift out of sync.\n\n**Solution: Code-First Approach**\n\n### Step 1: Generate OpenAPI from Code\n\nUse framework-specific tools to generate OpenAPI spec from code:\n\n**FastAPI (Python):**\n\`\`\`python\nfrom fastapi import FastAPI\n\napp = FastAPI(\n    title=\"Example API\",\n    description=\"API for document management\",\n    version=\"1.0.0\"\n)\n\n@app.get(\"/documents/{id}\", response_model=Document)\nasync def get_document(id: UUID):\n    \"\"\"Get document by ID.\"\"\"\n    ...\n\n# Auto-generated at /openapi.json\n\`\`\`\n\n**ASP.NET Core (C#):**\n\`\`\`csharp\n[HttpGet(\"/documents/{id}\")]\n[ProducesResponseType(typeof(Document), 200)]\n[ProducesResponseType(typeof(Error), 404)]\npublic IActionResult GetDocument(Guid id)\n{\n    // Swagger auto-generated from attributes\n}\n\`\`\`\n\n**Spring Boot (Java):**\n\`\`\`java\n@GetMapping(\"/documents/{id}\")\n@Operation(summary = \"Get document by ID\")\n@ApiResponse(responseCode = \"200\", content = @Content(schema = @Schema(implementation = Document.class)))\npublic Document getDocument(@PathVariable UUID id) {\n    // Swagger auto-generated from annotations\n}\n\`\`\`\n\n### Step 2: Validate on CI\n\nAdd CI check to ensure spec is up-to-date:\n\n\`\`\`yaml\n# .github/workflows/api-docs.yml\nname: API Docs\n\non: [push, pull_request]\n\njobs:\n  validate:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Generate OpenAPI spec\n        run: |\n          python -m app.generate_openapi > openapi-generated.yaml\n      \n      - name: Check if spec is up-to-date\n        run: |\n          diff openapi.yaml openapi-generated.yaml || (\n            echo \"ERROR: openapi.yaml is out of sync with code.\"\n            echo \"Run: python -m app.generate_openapi > openapi.yaml\"\n            exit 1\n          )\n      \n      - name: Validate spec\n        run: |\n          npx @redocly/cli lint openapi.yaml\n      \n      - name: Generate docs\n        run: |\n          npx @redocly/cli build-docs openapi.yaml -o api-docs.html\n      \n      - name: Deploy docs\n        if: github.ref == 'refs/heads/main'\n        run: |\n          aws s3 cp api-docs.html s3://docs.example.com/api/index.html\n\`\`\`\n\n### Step 3: API Changelog\n\nDocument all API changes:\n\n\`\`\`markdown\n# API Changelog\n\n## v1.1.0 (2026-01-24)\n\n### Added\n- New endpoint: GET /documents/{id}/versions (retrieve version history)\n- New field: Document.tags (array of strings)\n- New query param: ?tags=tag1,tag2 for filtering\n\n### Changed\n- Pagination.total is now optional (null for large datasets where count is expensive)\n\n### Deprecated\n- Field Document.category will be removed in v2.0 (use Document.tags instead)\n\n### Fixed\n- GET /documents now correctly filters by visibility=shared\n\n## v1.0.0 (2026-01-01)\n\n- Initial release\n\`\`\`\n\n### Step 4: Breaking Change Process\n\n**When making breaking change:**\n\n1. Create ADR documenting decision (ADR-XXX: Remove deprecated field)\n2. Announce deprecation 6 months before removal\n3. Add Deprecation header to responses\n4. Update API docs with migration guide\n5. Release v2 with breaking change\n6. Support v1 for 12 months after v2 release\n\n**Confidence:** [0.0-1.0]" \
  --confidence [0.0-1.0] \
  --tags "api-docs,sync,[api-name]"
```

### Step 6: Link All Documentation Entities

```bash
# Link documentation to task
engram relationship create \
  --source-id [TASK_ID] --source-type task \
  --target-id [OPENAPI_SPEC_ID] --target-type context \
  --relationship-type references --agent [AGENT]

engram relationship create \
  --source-id [TASK_ID] --source-type task \
  --target-id [PATTERNS_ID] --target-type reasoning \
  --relationship-type documents --agent [AGENT]

engram relationship create \
  --source-id [TASK_ID] --source-type task \
  --target-id [WORKFLOWS_ID] --target-type reasoning \
  --relationship-type documents --agent [AGENT]

engram relationship create \
  --source-id [TASK_ID] --source-type task \
  --target-id [SYNC_STRATEGY_ID] --target-type reasoning \
  --relationship-type documents --agent [AGENT]
```

## Querying API Documentation

After creating API docs, agents can retrieve:

```bash
# Get all API documentation
engram context list | grep "API"

# Get API specifications
engram context list | grep "OpenAPI\|Specification"

# Get API examples and workflows
engram reasoning list | grep "Example\|Workflow"

# Get all API docs for a task
engram relationship connected --entity-id [TASK_ID] --relationship-type references | grep -i "api"
```

## Related Skills

This skill integrates with:
- `engram-api-design` - Design precedes documentation
- `engram-adr` - API design decisions documented as ADRs
- `engram-test-driven-development` - API tests validate docs
- `engram-knowledge-transfer` - API docs aid onboarding
- `engram-use-engram-memory` - Store API evolution history in Engram
