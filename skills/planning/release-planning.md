---
name: engram-release-planning
description: "Plan releases with feature batching, migration paths, rollback strategies, and phased rollout plans."
---

# Release Planning (Engram-Integrated)

## Overview

Design comprehensive release plans that batch features strategically, define migration paths for breaking changes, establish rollback procedures, and create phased rollout strategies. Store release plans, deployment runbooks, and rollback procedures in Engram for coordination and risk reduction.

## When to Use

Use this skill when:
- Planning a major release with multiple features or breaking changes
- A release includes database migrations or infrastructure changes
- You need to coordinate deployment across multiple services
- Stakeholders ask about rollout strategy or rollback plans
- A feature requires gradual rollout or feature flags
- You're planning blue-green deployment or canary releases

## The Pattern

### Step 1: Define Release Scope and Goals

Identify what's included and why:

```bash
engram context create \
  --title "Release Plan: [Version] - [Name]" \
  --content "## Release Information\n\n**Version:** [e.g., v2.5.0]\n**Name:** [Release name/theme]\n**Target Date:** [Date]\n**Type:** [Major/Minor/Patch]\n\n## Business Goals\n\n**Primary Objectives:**\n1. [Goal 1: e.g., Enable enterprise tier customers]\n2. [Goal 2: e.g., Improve performance by 50%]\n3. [Goal 3: e.g., Reduce support burden]\n\n**Success Metrics:**\n- [Metric 1]: [e.g., 90% of enterprise customers adopt new features within 30 days]\n- [Metric 2]: [e.g., API latency p95 < 200ms]\n- [Metric 3]: [e.g., Support tickets reduced by 25%]\n\n## Feature Batching\n\n### Batch 1: Core Features (Must Have)\n\n**Feature: Payment Processing**\n- **Reason in release:** Core functionality for monetization\n- **Dependencies:** None\n- **Risk:** Medium (external integration)\n- **Rollback complexity:** Medium (financial transactions)\n\n**Feature: Advanced Search**\n- **Reason in release:** Bundled with enterprise tier\n- **Dependencies:** Elasticsearch infrastructure\n- **Risk:** Low (isolated feature)\n- **Rollback complexity:** Low (can disable via feature flag)\n\n### Batch 2: Enhancement Features (Nice to Have)\n\n**Feature: Real-time Notifications**\n- **Reason in release:** Improves UX, but not critical\n- **Dependencies:** WebSocket infrastructure\n- **Risk:** Medium (new architecture)\n- **Rollback complexity:** Medium (affects all active sessions)\n\n**Feature: Dark Mode UI**\n- **Reason in release:** Highly requested, low risk\n- **Dependencies:** None\n- **Risk:** Very low (cosmetic)\n- **Rollback complexity:** Very low (CSS only)\n\n### Batch 3: Deferred to Next Release\n\n**Feature: Mobile App**\n- **Reason deferred:** Not ready for testing\n- **Target:** v2.6.0\n\n**Feature: API v3 (Breaking Changes)**\n- **Reason deferred:** Requires customer migration period\n- **Target:** v3.0.0\n\n## Breaking Changes\n\n### API Changes\n- **Change:** [Description of breaking change]\n- **Affected endpoints:** [List]\n- **Migration path:** [How customers upgrade]\n- **Deprecation period:** [N months]\n\n### Database Schema Changes\n- **Change:** [e.g., Rename column user_name to username]\n- **Migration strategy:** [e.g., Add new column, backfill, deprecate old]\n- **Rollback complexity:** [High/Medium/Low]\n\n### Configuration Changes\n- **Change:** [e.g., New required environment variable]\n- **Migration path:** [How to update configs]\n- **Backward compatibility:** [Yes/No - details]\n\n## Dependencies\n\n**Internal:**\n- [Service A] must deploy v1.2.0 before this release\n- [Database migration] must complete before deployment\n\n**External:**\n- [Vendor X API] upgrade from v1 to v2\n- [Infrastructure] Kubernetes 1.28+ required\n\n## Risks\n\n### High Risk\n- [Risk 1]: [e.g., Payment integration may have edge cases]\n  - **Mitigation:** Extensive testing, gradual rollout\n\n### Medium Risk\n- [Risk 2]: [e.g., Database migration on large table (2B rows)]\n  - **Mitigation:** Test on production snapshot, run during low traffic\n\n### Low Risk\n- [Risk 3]: [e.g., UI changes may confuse users temporarily]\n  - **Mitigation:** In-app tutorial, documentation" \
  --source "release-planning" \
  --tags "release,release-planning,v[version]"
```

### Step 2: Design Migration Path

For breaking changes, define how customers transition:

```bash
engram reasoning create \
  --title "Migration Path: [Change Description]" \
  --task-id [TASK_ID] \
  --content "## Change Summary\n\n**What's changing:** [Description]\n**Why:** [Rationale for breaking change]\n**Affects:** [Who/what is impacted]\n\n## Migration Timeline\n\n**Phase 1: Deprecation Announcement (T-90 days)**\n- Publish migration guide\n- Email affected customers\n- Add deprecation warnings to API responses\n- Update documentation with migration examples\n\n**Phase 2: Dual Support (T-60 days to T+30 days)**\n- Both old and new API versions available\n- Old version returns deprecation headers\n- Dashboard shows usage of deprecated endpoints\n- Proactive outreach to heavy users of old API\n\n**Phase 3: Sunset Warning (T+30 to T+60 days)**\n- Increase deprecation warning severity\n- Daily emails to customers still on old API\n- Support team prepared for migration assistance\n- Hold \"office hours\" for migration help\n\n**Phase 4: Shutdown (T+60 days)**\n- Old API returns 410 Gone\n- Automatic redirect to migration guide\n- Manual exemptions on case-by-case basis\n\n## Migration Steps for Customers\n\n### Step 1: Update API Client\n\n```bash\n# Old API (deprecated)\nGET /api/v1/users?name=john\n\n# New API\nGET /api/v2/users?filter[name]=john\n```\n\n**Changes:**\n- Query parameters now use filter[] syntax\n- Response format changed from XML to JSON\n- Authentication now requires Bearer token instead of API key\n\n### Step 2: Update Response Parsing\n\n**Old response:**\n```xml\n<user>\n  <id>123</id>\n  <name>John</name>\n</user>\n```\n\n**New response:**\n```json\n{\n  \"data\": {\n    \"id\": \"123\",\n    \"type\": \"user\",\n    \"attributes\": {\n      \"name\": \"John\"\n    }\n  }\n}\n```\n\n### Step 3: Test in Sandbox\n\n- Sandbox environment: https://sandbox.example.com\n- Test API key provided: [How to obtain]\n- Validation checklist: [Link to doc]\n\n### Step 4: Deploy to Production\n\n- Update API base URL from v1 to v2\n- Monitor error rates for 24 hours\n- Rollback procedure: [Revert to old client version]\n\n## Support Resources\n\n**Migration Guide:** [URL]\n**API Changelog:** [URL]\n**Support Contact:** migrations@example.com\n**Office Hours:** Fridays 2-4pm UTC on Zoom [link]\n\n## Backward Compatibility\n\n**What's preserved:**\n- All v1 endpoints available until T+60 days\n- Data models remain same (only format changes)\n- Rate limits unchanged\n\n**What's not compatible:**\n- XML format no longer supported\n- API key auth deprecated (use Bearer tokens)\n- Response structure changed (requires parsing updates)\n\n## Rollback Plan\n\n**If migration fails:**\n- Old API can be re-enabled within 1 hour\n- Database schema supports both versions (dual-write)\n- No data loss during migration window\n\n**Confidence:** [0.0-1.0]" \
  --confidence [0.0-1.0] \
  --tags "release,migration,release-planning,v[version]"
```

### Step 3: Define Rollback Strategy

Establish procedures to undo the release:

```bash
engram reasoning create \
  --title "Rollback Strategy: [Release Version]" \
  --task-id [TASK_ID] \
  --content "## Rollback Decision Criteria\n\n**Automatic Rollback Triggers:**\n- Error rate >5% for >5 minutes\n- API latency p99 >2 seconds for >10 minutes\n- Database connection pool exhausted\n- Critical security vulnerability discovered\n\n**Manual Rollback Triggers:**\n- Data corruption detected\n- Critical bug affecting >10% of users\n- Performance degradation causing customer complaints\n- Executive decision (compliance, legal, business)\n\n## Rollback Procedures\n\n### Rollback Type 1: Application Code (Fast)\n\n**Complexity:** Low\n**Time to rollback:** 5-10 minutes\n**Risk:** Very low\n\n**Procedure:**\n1. Run rollback command: `kubectl rollout undo deployment/api-server`\n2. Verify previous version pods healthy: `kubectl get pods`\n3. Monitor error rates for 5 minutes\n4. Post incident report in #incidents Slack channel\n\n**Prerequisites:**\n- Previous Docker image available in registry\n- No database migration in this release (or see Type 2)\n\n**Testing:**\n- Rollback tested in staging: [Date]\n- Rollback time validated: [N minutes]\n\n### Rollback Type 2: Database Migration (Slow)\n\n**Complexity:** High\n**Time to rollback:** 30-60 minutes\n**Risk:** Medium (may lose data written during release)\n\n**Procedure:**\n1. Put application in maintenance mode\n2. Stop all application pods: `kubectl scale deployment/api-server --replicas=0`\n3. Run reverse migration: `alembic downgrade -1`\n4. Verify schema rolled back: Check column exists\n5. Deploy previous application version\n6. Verify application healthy\n7. Exit maintenance mode\n8. Monitor for data consistency issues\n\n**Prerequisites:**\n- Reverse migration tested in staging\n- Database backup taken before migration\n- Maintenance mode procedure tested\n\n**Data Loss Risk:**\n- Any data written during release (between migration and rollback) may be lost\n- Mitigation: Take database snapshot before rollback for later recovery\n\n**Testing:**\n- Reverse migration tested: [Date]\n- No data loss in test: [Confirmed/Issues found]\n\n### Rollback Type 3: Feature Flag Toggle (Instant)\n\n**Complexity:** Very low\n**Time to rollback:** <1 minute\n**Risk:** Very low\n\n**Procedure:**\n1. Open feature flag dashboard: [URL]\n2. Find flag: `enable_new_payment_flow`\n3. Set to `false` for all users (or specific cohort)\n4. Verify users see old experience\n5. Monitor metrics for 5 minutes\n\n**Prerequisites:**\n- Feature behind flag in code\n- Flag dashboard access for on-call engineer\n- Both old and new code paths functional\n\n**Testing:**\n- Flag toggle tested in staging: [Date]\n- Both paths verified working: [Date]\n\n### Rollback Type 4: Infrastructure (Complex)\n\n**Complexity:** Very high\n**Time to rollback:** 2-4 hours\n**Risk:** High (affects entire platform)\n\n**Procedure:**\n1. Declare P0 incident\n2. Assemble incident team (DevOps, Backend, Frontend)\n3. Follow infrastructure rollback runbook: [Link]\n4. Coordinate with external vendors if needed\n5. Execute rollback in stages:\n   - Stage 1: Roll back infrastructure changes\n   - Stage 2: Roll back application code\n   - Stage 3: Verify all services healthy\n6. Post-incident review within 24 hours\n\n**Prerequisites:**\n- Infrastructure as code in git (can revert commit)\n- Backup of previous infrastructure state\n- Runbook tested in disaster recovery drill\n\n**Examples:**\n- Kubernetes cluster upgrade\n- Database version upgrade\n- Load balancer configuration change\n\n## Rollback Testing\n\n**Pre-release validation:**\n- [ ] All rollback procedures tested in staging\n- [ ] Rollback times measured and acceptable\n- [ ] On-call engineer trained on rollback steps\n- [ ] Rollback documentation accessible during incident\n- [ ] Database backups verified restorable\n\n**Rollback rehearsal:**\n- Conducted: [Date]\n- Participants: [Names]\n- Issues found: [None/List]\n- Rollback time: [N minutes]\n\n## Post-Rollback Actions\n\n1. **Incident report** - Document what went wrong\n2. **Customer communication** - Notify affected users\n3. **Data recovery** - Restore any lost data from backup\n4. **Fix and re-release** - Address root cause before retry\n5. **Retrospective** - Why did we need to rollback?\n\n## Rollback Communication\n\n**Internal (Slack #incidents):**\n```\nðŸš¨ ROLLBACK IN PROGRESS ðŸš¨\nRelease: v2.5.0\nReason: [Error rate spike]\nETA: [10 minutes]\nStatus updates: Every 5 min\n```\n\n**External (Status page):**\n```\nWe've identified an issue with today's release and are rolling back to the previous version. Your data is safe. Service will be fully restored within [N] minutes.\n```\n\n**Customer notification:**\n- If rollback <15 minutes: Status page only\n- If rollback >15 minutes: Email affected customers\n- If data loss: Direct phone calls to affected customers\n\n## Confidence Levels\n\n**Type 1 (Application):** 0.95 - Well-tested, low risk\n**Type 2 (Database):** 0.70 - Complex, data loss risk\n**Type 3 (Feature Flag):** 0.99 - Instant, very safe\n**Type 4 (Infrastructure):** 0.50 - High complexity, rarely tested\n\n**Overall Rollback Confidence:** [0.0-1.0]" \
  --confidence [0.0-1.0] \
  --tags "release,rollback,release-planning,v[version]"
```

### Step 4: Design Phased Rollout Plan

Define gradual rollout strategy:

```bash
engram reasoning create \
  --title "Phased Rollout Plan: [Release Version]" \
  --task-id [TASK_ID] \
  --content "## Rollout Strategy\n\n**Approach:** [Canary/Blue-Green/Rolling/Feature Flag Percentage]\n\n**Duration:** [Total time from 0% to 100%]\n\n**Rollback threshold:** If error rate >3% at any phase, halt and rollback\n\n## Rollout Phases\n\n### Phase 1: Internal Dogfooding (1% traffic)\n\n**Audience:** Internal employees only\n**Duration:** 24 hours\n**Traffic:** 1% (via internal IP whitelist)\n\n**Success Criteria:**\n- Zero critical bugs reported by employees\n- No performance degradation observed\n- Positive feedback from internal users\n\n**Metrics to Monitor:**\n- Error rate (target: <0.5%)\n- API latency p95 (target: <300ms)\n- Database query time (target: <50ms)\n- User-reported issues (target: 0 critical)\n\n**Go/No-Go Decision:**\n- Go if: All metrics green, no critical issues\n- No-go if: Any critical bug or metric threshold exceeded\n- Decision maker: [Engineering lead]\n\n### Phase 2: Beta Users (5% traffic)\n\n**Audience:** Opted-in beta testers\n**Duration:** 48 hours\n**Traffic:** 5% (via user account flag: beta_tester=true)\n\n**Success Criteria:**\n- <3 critical bugs reported\n- Positive sentiment in beta feedback\n- No increase in support tickets\n\n**Metrics to Monitor:**\n- Error rate (target: <1%)\n- User engagement (target: no drop)\n- Support ticket volume (target: no increase)\n- Beta user feedback score (target: >4/5)\n\n**Go/No-Go Decision:**\n- Go if: Metrics within target, critical bugs fixed\n- No-go if: >3 critical bugs or negative sentiment\n- Decision maker: [Product + Engineering leads]\n\n### Phase 3: Small Cohort (20% traffic)\n\n**Audience:** Random 20% of users (sticky by user_id)\n**Duration:** 72 hours\n**Traffic:** 20% (via consistent hash on user_id)\n\n**Success Criteria:**\n- Error rate <2% (allows some edge case bugs)\n- Performance metrics stable\n- No revenue impact (for payment features)\n\n**Metrics to Monitor:**\n- Error rate (target: <2%)\n- Conversion rate (target: no drop >5%)\n- Revenue per user (target: no drop)\n- Customer support volume (target: no spike)\n\n**A/B Test:**\n- Compare 20% on new version vs 80% on old version\n- Measure: Engagement, conversion, satisfaction\n- Statistical significance: p<0.05\n\n**Go/No-Go Decision:**\n- Go if: No statistical difference in key metrics (or improvement)\n- No-go if: Significant negative impact on metrics\n- Decision maker: [Product lead]\n\n### Phase 4: Majority Rollout (50% traffic)\n\n**Audience:** Random 50% of users\n**Duration:** 48 hours\n**Traffic:** 50% (via feature flag percentage)\n\n**Success Criteria:**\n- All previous criteria maintained\n- Infrastructure scales appropriately\n- No unexpected cost increase\n\n**Metrics to Monitor:**\n- All previous metrics\n- Infrastructure CPU/memory (target: <80%)\n- Database connections (target: <500 of 1000 max)\n- Cloud costs (target: no unexpected increase)\n\n**Go/No-Go Decision:**\n- Go if: All systems stable at 50% load\n- No-go if: Infrastructure concerns or cost spike\n- Decision maker: [Engineering + DevOps leads]\n\n### Phase 5: Full Rollout (100% traffic)\n\n**Audience:** All users\n**Duration:** Permanent\n**Traffic:** 100%\n\n**Success Criteria:**\n- All previous criteria maintained at 100% scale\n- Ready to remove old code paths\n- Feature flag can be removed after 7 days\n\n**Metrics to Monitor:**\n- All previous metrics\n- Long-term: 7-day and 30-day trends\n\n**Post-Rollout Actions:**\n1. Monitor for 7 days\n2. Remove feature flag if no issues\n3. Delete old code paths\n4. Close release ticket\n5. Celebrate! ðŸŽ‰\n\n## Rollout Controls\n\n**Feature Flag:** `enable_v2_5_0` (Boolean, percentage-based)\n**Dashboard:** [URL to feature flag control panel]\n**Access:** On-call engineer, engineering leads\n\n**Commands:**\n```bash\n# Check current rollout percentage\ncurl https://flags.example.com/api/flags/enable_v2_5_0\n\n# Update to 20%\ncurl -X PATCH https://flags.example.com/api/flags/enable_v2_5_0 \\\n  -d '{\"percentage\": 20}'\n\n# Emergency disable (rollback to 0%)\ncurl -X PATCH https://flags.example.com/api/flags/enable_v2_5_0 \\\n  -d '{\"percentage\": 0}'\n```\n\n## Monitoring and Alerts\n\n**Dashboards:**\n- Release health: [Grafana URL]\n- Error rates: [Datadog URL]\n- User metrics: [Mixpanel URL]\n\n**Alerts:**\n- Error rate >3%: Page on-call immediately\n- Latency p95 >1s: Slack alert to #incidents\n- Rollout paused: Email engineering leads\n\n**On-call schedule:**\n- Primary: [Name, Contact]\n- Secondary: [Name, Contact]\n- Escalation: [Engineering lead]\n\n## Rollout Timeline\n\n**Day 1 (Monday):**\n- 9am: Deploy to production (0% traffic)\n- 10am: Enable Phase 1 (1% internal)\n\n**Day 2 (Tuesday):**\n- 10am: Phase 1 review\n- 11am: Enable Phase 2 (5% beta) if approved\n\n**Day 4 (Thursday):**\n- 10am: Phase 2 review\n- 11am: Enable Phase 3 (20% cohort) if approved\n\n**Day 7 (Sunday):**\n- 10am: Phase 3 review\n- 11am: Enable Phase 4 (50%) if approved\n\n**Day 9 (Tuesday):**\n- 10am: Phase 4 review\n- 11am: Enable Phase 5 (100%) if approved\n\n**Day 16 (Next Tuesday):**\n- Remove feature flag\n- Delete old code paths\n- Release complete âœ“\n\n## Communication Plan\n\n**Internal updates (Slack #releases):**\n- Every phase transition: \"Phase N starting - [N%] traffic\"\n- Daily summary: \"Day N complete - no issues\" or \"[Issue] detected\"\n- Rollout complete: \"Release v2.5.0 at 100% - removing flag in 7 days\"\n\n**External updates (if user-visible):**\n- Phase 3: Blog post announcing new features\n- Phase 5: Email to all users about new features\n- No updates for internal changes (performance, refactoring)\n\n**Stakeholder updates:**\n- Daily email to [stakeholder list] during rollout\n- Final summary when rollout complete\n\n**Confidence:** [0.0-1.0]" \
  --confidence [0.0-1.0] \
  --tags "release,rollout,release-planning,v[version]"
```

### Step 5: Create Release Runbook

Document step-by-step deployment procedure:

```bash
engram context create \
  --title "Release Runbook: [Version]" \
  --content "## Pre-Release Checklist\n\n### Code Readiness\n- [ ] All features complete and merged to main\n- [ ] All tests passing (unit, integration, e2e)\n- [ ] Code review approved by [N] senior engineers\n- [ ] Security scan passed (no critical vulnerabilities)\n- [ ] Performance testing complete (load, stress)\n\n### Infrastructure Readiness\n- [ ] Database migrations tested on production snapshot\n- [ ] Staging environment deployed and validated\n- [ ] Production capacity verified (CPU, memory, disk)\n- [ ] Monitoring dashboards configured\n- [ ] Alerts configured and tested\n\n### Documentation Readiness\n- [ ] Release notes written: [Link]\n- [ ] API changelog updated: [Link]\n- [ ] Migration guide published (if breaking changes): [Link]\n- [ ] Internal runbook reviewed: [This document]\n\n### Team Readiness\n- [ ] Release engineer assigned: [Name]\n- [ ] On-call engineer available: [Name, Contact]\n- [ ] Stakeholders notified of release window\n- [ ] Customer support briefed on new features\n- [ ] Rollback procedure rehearsed: [Date]\n\n## Deployment Steps\n\n### Step 1: Pre-Deployment (T-30 min)\n\n**Time:** [Date] at [Time]\n**Person:** [Release engineer name]\n\n1. Announce in Slack #releases:\n   ```\n   Starting release v2.5.0 deployment at [Time]\n   Expected duration: 45 minutes\n   Traffic impact: None (feature flags disabled)\n   ```\n\n2. Verify all pre-release checklist items complete\n\n3. Take database backup:\n   ```bash\n   pg_dump production > backup_v2.5.0_$(date +%Y%m%d).sql\n   ```\n\n4. Create release tag:\n   ```bash\n   git tag -a v2.5.0 -m \"Release v2.5.0 - Payment and Search\"\n   git push origin v2.5.0\n   ```\n\n### Step 2: Infrastructure Changes (T-15 min)\n\n1. Apply infrastructure changes (if any):\n   ```bash\n   kubectl apply -f k8s/elasticsearch-deployment.yaml\n   kubectl wait --for=condition=available deployment/elasticsearch\n   ```\n\n2. Run database migrations:\n   ```bash\n   alembic upgrade head\n   ```\n\n3. Verify migration success:\n   ```bash\n   psql production -c \"SELECT version FROM alembic_version;\"\n   # Should show latest version\n   ```\n\n### Step 3: Application Deployment (T+0)\n\n1. Build and push Docker image:\n   ```bash\n   docker build -t api-server:v2.5.0 .\n   docker push registry.example.com/api-server:v2.5.0\n   ```\n\n2. Update Kubernetes deployment:\n   ```bash\n   kubectl set image deployment/api-server \\\n     api-server=registry.example.com/api-server:v2.5.0\n   ```\n\n3. Monitor rollout status:\n   ```bash\n   kubectl rollout status deployment/api-server\n   # Wait for \"successfully rolled out\"\n   ```\n\n4. Verify pods healthy:\n   ```bash\n   kubectl get pods -l app=api-server\n   # All should show STATUS=Running, READY=1/1\n   ```\n\n### Step 4: Smoke Testing (T+10 min)\n\n1. Run automated smoke tests:\n   ```bash\n   npm run test:smoke -- --env production\n   ```\n\n2. Manual verification:\n   - [ ] Homepage loads: https://example.com\n   - [ ] Login works: Test with internal account\n   - [ ] API health check: curl https://api.example.com/health\n   - [ ] Database connectivity: Check query response time\n\n3. Check error rates in Datadog:\n   - [ ] Error rate <1% (normal baseline)\n   - [ ] No spike in 500 errors\n   - [ ] API latency p95 <300ms\n\n### Step 5: Enable Feature Flags (T+15 min)\n\nFollow phased rollout plan:\n\n1. Enable Phase 1 (1% internal):\n   ```bash\n   curl -X PATCH https://flags.example.com/api/flags/enable_v2_5_0 \\\n     -d '{\"percentage\": 1, \"whitelist\": [\"internal\"]}'\n   ```\n\n2. Monitor for 15 minutes:\n   - Watch error rates\n   - Check internal Slack for feedback\n   - Verify new features working\n\n3. If all good, announce Phase 1 complete:\n   ```\n   âœ… Phase 1 complete (1% internal)\n   No issues detected\n   Proceeding to Phase 2 in 24 hours\n   ```\n\n### Step 6: Post-Deployment (T+30 min)\n\n1. Update status page:\n   ```\n   Deployment complete. All systems operational.\n   ```\n\n2. Notify stakeholders:\n   - Email to [stakeholder list]\n   - Update in Slack #releases\n   - Update project management tool\n\n3. Monitor for 2 hours:\n   - Set reminder to check metrics at T+1 hour and T+2 hour\n   - Watch for alerts\n   - Review error logs\n\n4. Close deployment ticket\n\n## Rollout Schedule (Next 10 Days)\n\n**Day 1:** Phase 1 (1% internal)\n**Day 2:** Phase 2 (5% beta)\n**Day 4:** Phase 3 (20% cohort)\n**Day 7:** Phase 4 (50% traffic)\n**Day 9:** Phase 5 (100% traffic)\n**Day 16:** Remove feature flag, cleanup\n\n## Emergency Contacts\n\n**Release Engineer:** [Name] - [Phone] - [Slack]\n**On-Call Primary:** [Name] - [Phone] - [Slack]\n**On-Call Secondary:** [Name] - [Phone] - [Slack]\n**Engineering Lead:** [Name] - [Phone] - [Slack]\n**DevOps Lead:** [Name] - [Phone] - [Slack]\n\n## Troubleshooting\n\n### Issue: Deployment stuck / pods not starting\n\n**Check:** `kubectl describe pod <pod-name>`\n**Common causes:** Image pull error, resource limits, failed health check\n**Resolution:** Fix issue and re-deploy, or rollback\n\n### Issue: Database migration failed\n\n**Check:** Migration logs in database\n**Resolution:** \n1. Put app in maintenance mode\n2. Run reverse migration: `alembic downgrade -1`\n3. Fix migration script\n4. Re-run: `alembic upgrade head`\n\n### Issue: High error rate after deployment\n\n**Check:** Error logs, Datadog APM traces\n**Resolution:**\n1. If >5% errors: Immediate rollback\n2. If <5% errors: Investigate root cause, may be acceptable\n3. Fix and re-deploy, or rollback\n\n### Issue: Feature flag not working\n\n**Check:** Feature flag service status, user assignment\n**Resolution:**\n1. Verify flag exists: `curl https://flags.example.com/api/flags/enable_v2_5_0`\n2. Check user in target cohort\n3. Clear cache if needed\n\n## Post-Release Activities\n\n### Day 2: Phase Review\n- Review metrics from Phase 1\n- Decide go/no-go for Phase 2\n- Document any issues found\n\n### Week 2: Release Retrospective\n- What went well?\n- What could be improved?\n- Update runbook with lessons learned\n\n### Week 3: Feature Flag Cleanup\n- Remove feature flag from code\n- Delete old code paths\n- Reduce technical debt\n\n### Month 1: Success Metrics Review\n- Measure against release goals\n- Report to stakeholders\n- Plan next release based on learnings" \
  --source "release-planning" \
  --tags "release,runbook,release-planning,v[version]"
```

### Step 6: Link Release Plan Entities

```bash
# Link all release planning entities
engram relationship create \
  --source-id [TASK_ID] --source-type task \
  --target-id [RELEASE_PLAN_ID] --target-type context \
  --relationship-type references \
  --agent [AGENT]

engram relationship create \
  --source-id [TASK_ID] --source-type task \
  --target-id [MIGRATION_PATH_ID] --target-type reasoning \
  --relationship-type documents \
  --agent [AGENT]

engram relationship create \
  --source-id [TASK_ID] --source-type task \
  --target-id [ROLLBACK_STRATEGY_ID] --target-type reasoning \
  --relationship-type documents \
  --agent [AGENT]

engram relationship create \
  --source-id [TASK_ID] --source-type task \
  --target-id [ROLLOUT_PLAN_ID] --target-type reasoning \
  --relationship-type documents \
  --agent [AGENT]

engram relationship create \
  --source-id [TASK_ID] --source-type task \
  --target-id [RUNBOOK_ID] --target-type context \
  --relationship-type references \
  --agent [AGENT]
```

## Example

User wants to plan release v2.5.0 with payment processing and search features.

### Step 1: Define Release Scope

```bash
RELEASE=$(engram context create \
  --title "Release Plan: v2.5.0 - Enterprise Features" \
  --content "## Release Information\n\n**Version:** v2.5.0\n**Name:** Enterprise Features\n**Target Date:** March 15, 2026\n**Type:** Minor (new features, backward compatible)\n\n## Business Goals\n\n**Primary Objectives:**\n1. Enable enterprise tier ($199/month) for B2B customers\n2. Monetize through payment processing integration\n3. Differentiate from competitors with advanced search\n\n**Success Metrics:**\n- 50 enterprise customers signed up within 60 days\n- Payment processing handles $100K volume in first month\n- Advanced search used by 70% of enterprise users\n\n## Feature Batching\n\n### Batch 1: Core Features (Must Have)\n\n**Feature: Payment Processing (Stripe Integration)**\n- **Reason in release:** Required for monetization, blocks enterprise tier\n- **Dependencies:** Stripe production account approved, PCI compliance passed\n- **Risk:** Medium (external integration, financial transactions)\n- **Rollback complexity:** Medium (must not lose payment data)\n\n**Feature: Advanced Search (Elasticsearch)**\n- **Reason in release:** Key enterprise differentiator, bundled with tier\n- **Dependencies:** Elasticsearch cluster deployed\n- **Risk:** Low (isolated feature, can disable via flag)\n- **Rollback complexity:** Low (search falls back to basic SQL)\n\n### Batch 2: Enhancement Features (Nice to Have)\n\n**Feature: Real-time Notifications (WebSocket)**\n- **Reason in release:** Improves enterprise UX, shows platform sophistication\n- **Dependencies:** WebSocket infrastructure, Redis pub/sub\n- **Risk:** Medium (new architecture, affects all users)\n- **Rollback complexity:** Medium (graceful degradation to polling)\n\n**Feature: Dark Mode UI**\n- **Reason in release:** Highly requested (200+ votes), easy to deliver\n- **Dependencies:** None\n- **Risk:** Very low (cosmetic change)\n- **Rollback complexity:** Very low (CSS toggle)\n\n### Batch 3: Deferred to Next Release\n\n**Feature: Mobile App Redesign**\n- **Reason deferred:** QA found 15 bugs, not ready\n- **Target:** v2.6.0 (April 2026)\n\n**Feature: API v3 (Breaking Changes)**\n- **Reason deferred:** Requires 90-day migration period for customers\n- **Target:** v3.0.0 (Q3 2026)\n\n## Breaking Changes\n\nNone in this release (minor version - backward compatible)\n\n## Dependencies\n\n**Internal:**\n- Frontend component library v1.8.0 deployed (completed March 1)\n- Elasticsearch cluster provisioned (completed March 5)\n- WebSocket infrastructure tested (completed March 8)\n\n**External:**\n- Stripe production account approved (completed Feb 20)\n- PCI compliance review passed (completed March 1)\n- SSL certificates renewed (valid until 2027)\n\n## Risks\n\n### High Risk\n- Payment integration edge cases: Refunds, disputes, failed charges\n  - **Mitigation:** Extensive testing with test cards, gradual rollout, Stripe support SLA\n\n### Medium Risk\n- WebSocket scaling under load: Untested at 100K concurrent connections\n  - **Mitigation:** Load testing at 2x expected traffic, horizontal scaling ready\n- Elasticsearch cluster stability: First time in production\n  - **Mitigation:** Fallback to SQL search, monitoring, DevOps on standby\n\n### Low Risk\n- UI changes confuse users: Dark mode, notification UI\n  - **Mitigation:** In-app tutorial, blog post, support documentation" \
  --source "release-planning" \
  --tags "release,release-planning,v2.5.0" \
  --json | jq -r '.id')

echo "Release plan created: $RELEASE"
```

### Step 2: Create Rollback Strategy

```bash
ROLLBACK=$(engram reasoning create \
  --title "Rollback Strategy: v2.5.0" \
  --task-id a3f8b2c1-1234-5678-90ab-cdef12345678 \
  --content "## Rollback Decision Criteria\n\n**Automatic Rollback Triggers:**\n- Error rate >5% for >5 minutes\n- API latency p99 >2 seconds for >10 minutes  \n- Payment processing failure rate >2%\n- Database connection pool >90% for >5 minutes\n\n**Manual Rollback Triggers:**\n- Payment data corruption detected\n- Critical security vulnerability in Stripe integration\n- Elasticsearch cluster unresponsive >10 minutes\n- Executive decision (e.g., major customer complaint)\n\n## Rollback Procedures\n\n### Rollback Type 1: Feature Flag Toggle (Preferred)\n\n**Complexity:** Very low\n**Time to rollback:** <1 minute\n**Risk:** Very low\n**Applies to:** All features in this release\n\n**Procedure:**\n1. Open feature flag dashboard: https://flags.example.com/dashboard\n2. Set flags to 0% (or target cohort):\n   - `enable_payment_processing`: false\n   - `enable_elasticsearch_search`: false\n   - `enable_websocket_notifications`: false\n   - `enable_dark_mode`: false\n3. Verify users see old experience (test with internal account)\n4. Post in Slack #incidents: \"Features disabled via flags - investigating\"\n5. Monitor error rates for 5 minutes\n\n**Prerequisites (already met):**\n- All new features behind feature flags âœ“\n- Old code paths still functional âœ“\n- Flag dashboard accessible âœ“\n\n**Testing:**\n- Flag toggle tested in staging: March 10, 2026 âœ“\n- Both paths verified working: March 10, 2026 âœ“\n- Rollback drill completed: March 12, 2026 âœ“\n\n### Rollback Type 2: Application Code (If Needed)\n\n**Complexity:** Low\n**Time to rollback:** 5-10 minutes\n**Risk:** Low\n**Applies to:** Entire application\n\n**Procedure:**\n1. Disable all feature flags (see Type 1)\n2. Roll back Kubernetes deployment:\n   ```bash\n   kubectl rollout undo deployment/api-server\n   kubectl rollout undo deployment/websocket-server\n   ```\n3. Verify pods healthy:\n   ```bash\n   kubectl get pods | grep -E \"api-server|websocket\"\n   # All should show Running, Ready 1/1\n   ```\n4. Run smoke tests: `npm run test:smoke`\n5. Monitor for 10 minutes\n\n**Prerequisites:**\n- Previous Docker images available in registry âœ“\n- No database migration (this release has none) âœ“\n\n**Testing:**\n- Rollback tested in staging: March 12, 2026 âœ“\n- Rollback time: 7 minutes âœ“\n\n### Rollback Type 3: Database (Not Needed)\n\nNo database migrations in v2.5.0 - all schema changes were in v2.4.0.\n\n### Rollback Type 4: Infrastructure (Last Resort)\n\n**Complexity:** High\n**Time to rollback:** 1-2 hours\n**Risk:** Medium\n**Applies to:** Elasticsearch cluster, WebSocket infrastructure\n\n**Procedure:**\n1. Declare P0 incident - page engineering lead\n2. Disable feature flags (Type 1)\n3. Roll back infrastructure:\n   ```bash\n   # Elasticsearch\n   kubectl delete -f k8s/elasticsearch.yaml\n   # System falls back to SQL search automatically\n   \n   # WebSocket servers\n   kubectl scale deployment/websocket-server --replicas=0\n   # Clients fall back to polling automatically\n   ```\n4. Verify application healthy without new infrastructure\n5. Schedule infrastructure fix for next release\n\n**Prerequisites:**\n- Fallback mechanisms in code (SQL search, polling) âœ“\n- Graceful degradation tested âœ“\n\n## Rollback Testing\n\n**Pre-release validation:**\n- [âœ“] All rollback procedures tested in staging (March 12)\n- [âœ“] Rollback times measured: 1 min (flags), 7 min (code), 90 min (infra)\n- [âœ“] On-call engineer trained: Alice Chen (March 13)\n- [âœ“] Rollback documentation reviewed by team (March 13)\n- [N/A] Database backups (no migrations this release)\n\n**Rollback rehearsal:**\n- Conducted: March 12, 2026\n- Participants: Alice (on-call), Bob (release eng), Carol (DevOps)\n- Issues found: None\n- Rollback time (Type 1): 45 seconds âœ“\n- Rollback time (Type 2): 7 minutes âœ“\n\n## Post-Rollback Actions\n\n1. **Incident report** - Document in Slack #incidents and Linear\n2. **Customer communication** - Status page update (if user-facing impact)\n3. **Root cause analysis** - Why did rollback trigger?\n4. **Fix and re-release** - Address issue before re-enabling features\n5. **Retrospective** - Team meeting within 24 hours\n\n## Rollback Communication\n\n**Internal (Slack #incidents):**\n```\nðŸš¨ ROLLBACK IN PROGRESS ðŸš¨\nRelease: v2.5.0\nReason: [Payment processing error rate 8%]\nMethod: Feature flag disable (Type 1)\nETA: <1 minute\nImpact: New features disabled, existing functionality unaffected\nStatus: [Bob Wilson] will update every 5 min\n```\n\n**External (Status page) - Only if user-facing impact >15 min:**\n```\nWe've temporarily disabled some new features while we investigate an issue. All existing functionality is working normally. Your data is safe.\n```\n\n**Customer notification:**\n- If feature flag rollback (<1 min impact): No notification needed\n- If code rollback (5-10 min impact): Status page only\n- If infrastructure rollback (>1 hour): Email enterprise customers\n\n## Confidence Levels\n\n**Type 1 (Feature Flag):** 0.99 - Instant, tested, very safe âœ“ PREFERRED\n**Type 2 (Application Code):** 0.95 - Quick, well-tested\n**Type 3 (Database):** N/A - No database changes\n**Type 4 (Infrastructure):** 0.75 - Complex but has fallbacks\n\n**Overall Rollback Confidence:** 0.95 (Very confident - Type 1 covers all features)" \
  --confidence 0.95 \
  --tags "release,rollback,release-planning,v2.5.0" \
  --json | jq -r '.id')

echo "Rollback strategy created: $ROLLBACK"
```

### Step 3: Design Phased Rollout

```bash
ROLLOUT=$(engram reasoning create \
  --title "Phased Rollout Plan: v2.5.0" \
  --task-id a3f8b2c1-1234-5678-90ab-cdef12345678 \
  --content "## Rollout Strategy\n\n**Approach:** Feature flag percentage-based with cohort targeting\n**Duration:** 10 days (March 15 - March 25, 2026)\n**Rollback threshold:** If error rate >3% or payment failure rate >2%, halt and rollback\n\n## Rollout Phases\n\n### Phase 1: Internal Dogfooding (Day 1 - March 15)\n\n**Audience:** Employees only (~50 users)\n**Duration:** 24 hours\n**Traffic:** 1% (internal email domain whitelist)\n\n**Flags:**\n```bash\nenable_payment_processing: 1% (whitelist: @example.com)\nenable_elasticsearch_search: 1% (whitelist: @example.com)\nenable_websocket_notifications: 1% (whitelist: @example.com)\nenable_dark_mode: 1% (whitelist: @example.com)\n```\n\n**Success Criteria:**\n- Zero critical bugs reported by employees\n- Payment test transactions succeed (use Stripe test mode)\n- Search returns relevant results\n- WebSocket connections stable\n\n**Metrics to Monitor:**\n- Error rate: <0.5% (current baseline: 0.2%)\n- Payment processing success rate: >98%\n- Search query latency: <200ms p95\n- WebSocket connection duration: >5 minutes average\n\n**Go/No-Go Decision (March 16, 10am):**\n- Go if: All metrics green, no critical bugs, positive feedback\n- No-go if: Any critical bug or metric exceeds threshold\n- Decision maker: Alice Chen (Engineering Lead)\n\n### Phase 2: Beta Users (Days 2-3 - March 16-17)\n\n**Audience:** Opted-in beta testers (~500 users)\n**Duration:** 48 hours\n**Traffic:** 5% (user flag: beta_tester=true)\n\n**Success Criteria:**\n- <3 critical bugs reported\n- Payment processing works in production mode\n- Positive feedback from beta users (>4/5 rating)\n\n**Metrics to Monitor:**\n- Error rate: <1%\n- Payment transactions: Monitor first 10 closely\n- Search usage: >50% of beta users try search\n- Support tickets: No increase above baseline\n\n**Go/No-Go Decision (March 18, 10am):**\n- Go if: <3 critical bugs (fixed), metrics within target\n- No-go if: Payment issues or negative beta feedback\n- Decision maker: Alice Chen + Product Lead\n\n### Phase 3: Early Adopters (Days 4-6 - March 18-20)\n\n**Audience:** Users who signed up for enterprise tier early access (~2000 users)\n**Duration:** 72 hours\n**Traffic:** 20% (consistent hash on user_id for sticky assignment)\n\n**Success Criteria:**\n- Payment processing handles $10K+ volume successfully\n- Search performance stable under higher load\n- Enterprise customers satisfied (no churn)\n\n**Metrics to Monitor:**\n- Error rate: <2%\n- Payment volume: $10K+ processed\n- Payment disputes: 0 (critical if any)\n- Search query volume: 10K+ queries\n- Elasticsearch cluster: CPU <70%, memory <80%\n\n**A/B Test:**\n- Compare 20% with new features vs 80% without\n- Measure: Engagement (+15% target), conversion (+10% target)\n- Statistical significance: p<0.05 required to proceed\n\n**Go/No-Go Decision (March 21, 10am):**\n- Go if: Metrics stable, no payment issues, positive or neutral A/B results\n- No-go if: Payment disputes, negative impact on conversion, infrastructure stress\n- Decision maker: Alice Chen + Product Lead + Finance (for payment sign-off)\n\n### Phase 4: Majority Rollout (Days 7-8 - March 21-22)\n\n**Audience:** 50% of all users\n**Duration:** 48 hours\n**Traffic:** 50% (feature flag percentage)\n\n**Success Criteria:**\n- Infrastructure scales to 50% load smoothly\n- Payment processing handles proportional volume increase\n- No cost surprises (Elasticsearch, Stripe fees)\n\n**Metrics to Monitor:**\n- All previous metrics\n- Infrastructure: CPU <80%, memory <85%, disk <70%\n- Elasticsearch cluster: Query latency stable\n- WebSocket connections: ~50K concurrent (monitor connection churn)\n- Cloud costs: On track with budget ($2K/day expected)\n\n**Go/No-Go Decision (March 23, 10am):**\n- Go if: Infrastructure stable, costs in budget, no user complaints\n- No-go if: Infrastructure at capacity, cost overruns, degraded performance\n- Decision maker: Alice Chen + DevOps Lead + Finance\n\n### Phase 5: Full Rollout (Day 9 - March 23)\n\n**Audience:** All users (100%)\n**Duration:** Permanent\n**Traffic:** 100%\n\n**Success Criteria:**\n- All metrics stable at 100% load\n- Ready to commit to features (remove flag in 7 days)\n\n**Metrics to Monitor (first 48 hours):**\n- All previous metrics\n- Long-term trends: 7-day engagement, 30-day retention\n- Payment processing: Total volume, success rate, customer satisfaction\n\n**Post-Rollout Actions (March 30):**\n1. Monitor for 7 days\n2. Remove feature flags if no issues\n3. Delete old code paths (SQL search fallback, polling fallback)\n4. Update documentation\n5. Close release ticket\n6. Team celebration! ðŸŽ‰\n\n## Rollout Controls\n\n**Feature Flags Dashboard:** https://flags.example.com/dashboard\n\n**Flags:**\n- `enable_payment_processing`\n- `enable_elasticsearch_search`\n- `enable_websocket_notifications`\n- `enable_dark_mode`\n\n**Access:** Alice Chen, Bob Wilson, Carol Davis (on-call engineers)\n\n**Emergency Disable:**\n```bash\n# Disable all v2.5.0 features instantly\ncurl -X POST https://flags.example.com/api/emergency-disable \\\n  -d '{\"release\": \"v2.5.0\"}' \\\n  -H \"Authorization: Bearer $EMERGENCY_TOKEN\"\n```\n\n## Monitoring and Alerts\n\n**Dashboards:**\n- Release health: https://grafana.example.com/d/release-v2-5-0\n- Error rates: https://datadog.example.com/dashboard/errors\n- Payment metrics: https://stripe.com/dashboard\n- Elasticsearch: https://kibana.example.com\n\n**Alerts (PagerDuty):**\n- Error rate >3%: Page on-call immediately\n- Payment failure rate >2%: Page on-call + finance lead\n- Elasticsearch cluster down: Page on-call + DevOps\n- Latency p95 >1s: Slack alert to #incidents\n\n**On-call schedule (March 15-25):**\n- Primary: Bob Wilson (bob@example.com, +1-555-0123)\n- Secondary: Carol Davis (carol@example.com, +1-555-0124)\n- Escalation: Alice Chen (alice@example.com, +1-555-0125)\n\n## Rollout Timeline\n\n**March 15 (Monday) - Day 1:**\n- 9am: Deploy v2.5.0 to production (0% traffic)\n- 10am: Enable Phase 1 (1% internal)\n- 5pm: Phase 1 review - go/no-go meeting\n\n**March 16 (Tuesday) - Day 2:**\n- 10am: Enable Phase 2 (5% beta)\n\n**March 18 (Thursday) - Day 4:**\n- 10am: Phase 2 review - go/no-go meeting\n- 11am: Enable Phase 3 (20% early adopters)\n\n**March 21 (Sunday) - Day 7:**\n- 10am: Phase 3 review - go/no-go meeting\n- 11am: Enable Phase 4 (50%)\n\n**March 23 (Tuesday) - Day 9:**\n- 10am: Phase 4 review - go/no-go meeting\n- 11am: Enable Phase 5 (100%) âœ“\n\n**March 30 (Next Tuesday) - Day 16:**\n- Remove feature flags\n- Delete old code paths\n- Release complete âœ“\n\n## Communication Plan\n\n**Internal (Slack #releases):**\n- Every phase: \"Phase N starting - [N%] traffic. Monitoring...\"\n- Daily: \"Day N complete - [Summary of metrics and issues]\"\n- Complete: \"v2.5.0 at 100% - stable for 7 days - removing flags\"\n\n**External:**\n- Phase 3: Blog post \"Announcing Enterprise Features\"\n- Phase 5: Email to all users \"New Features Available\"\n- Support KB: Updated with new feature documentation\n\n**Stakeholder updates:**\n- Daily email to [CEO, VP Eng, VP Product, Finance] during rollout\n- Final summary when 100% complete\n\n**Confidence:** 0.90" \
  --confidence 0.90 \
  --tags "release,rollout,release-planning,v2.5.0" \
  --json | jq -r '.id')

echo "Rollout plan created: $ROLLOUT"
```

### Step 4: Link All Entities

```bash
engram relationship create \
  --source-id a3f8b2c1-1234-5678-90ab-cdef12345678 --source-type task \
  --target-id $RELEASE --target-type context \
  --relationship-type references \
  --agent default

engram relationship create \
  --source-id a3f8b2c1-1234-5678-90ab-cdef12345678 --source-type task \
  --target-id $ROLLBACK --target-type reasoning \
  --relationship-type documents \
  --agent default

engram relationship create \
  --source-id a3f8b2c1-1234-5678-90ab-cdef12345678 --source-type task \
  --target-id $ROLLOUT --target-type reasoning \
  --relationship-type documents \
  --agent default
```

### Step 5: Communicate to Stakeholders

Agent presents release plan:

"Release v2.5.0 planned for March 15-25. Includes 4 features: payments (core), search (core), notifications (enhancement), dark mode (enhancement). Rollout: 10-day phased approach (1% â†’ 5% â†’ 20% â†’ 50% â†’ 100%). Rollback: <1 minute via feature flags (confidence: 0.95). All features behind flags. Go/no-go gates at each phase. Runbook complete. Ready to proceed?"

## Querying Release Plans

After creating release plan, retrieve information:

```bash
# Get release plan
engram context list | grep "Release Plan:"

# Get rollback strategies
engram reasoning list | grep "Rollback Strategy:"

# Get rollout plans
engram reasoning list | grep "Phased Rollout Plan:"

# Get runbooks
engram context list | grep "Release Runbook:"

# Get all release planning for a version
engram relationship connected --entity-id [TASK_ID] | grep -E "Release|Rollback|Rollout|Runbook"
```

## Related Skills

This skill integrates with:
- `engram-capacity-planning` - Ensure team capacity for release work
- `engram-dependency-mapping` - Identify dependencies blocking release
- `engram-risk-assessment` - Assess deployment and rollback risks
- `engram-roadmap-planning` - Align releases with roadmap milestones
- `engram-system-design` - Validate architecture supports release strategy
